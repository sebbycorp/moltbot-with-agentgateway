# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ”‘ Credential Leak Protection Policies
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# Protects against accidental API key leaks:
#   - OpenAI API keys (sk-...)
#   - GitHub Personal Access Tokens (ghp_...)
#   - Slack Bot Tokens (xoxb-...)
#
# Action: REJECT - Blocks requests containing credential patterns
#
---
# Block OpenAI API Keys
apiVersion: agentgateway.dev/v1alpha1
kind: AgentgatewayPolicy
metadata:
  name: 10-block-openai-api-keys
  namespace: agentgateway-system
  labels:
    demo: agentgateway
    category: credential-protection
  annotations:
    description: "Blocks OpenAI API keys (sk-...) in prompts"
spec:
  targetRefs:
  - group: gateway.networking.k8s.io
    kind: HTTPRoute
    name: multi-llm-route
  backend:
    ai:
      promptGuard:
        request:
        - regex:
            action: Reject
            matches:
            - "sk-[a-zA-Z0-9]{20,}"
          response:
            message: "ğŸ”‘ Blocked: OpenAI API key detected in prompt"
---
# Block GitHub Tokens
apiVersion: agentgateway.dev/v1alpha1
kind: AgentgatewayPolicy
metadata:
  name: 11-block-github-tokens
  namespace: agentgateway-system
  labels:
    demo: agentgateway
    category: credential-protection
  annotations:
    description: "Blocks GitHub personal access tokens in prompts"
spec:
  targetRefs:
  - group: gateway.networking.k8s.io
    kind: HTTPRoute
    name: multi-llm-route
  backend:
    ai:
      promptGuard:
        request:
        - regex:
            action: Reject
            matches:
            - "ghp_[a-zA-Z0-9]{36}"
          response:
            message: "ğŸ”‘ Blocked: GitHub token detected in prompt"
---
# Block Slack Tokens
apiVersion: agentgateway.dev/v1alpha1
kind: AgentgatewayPolicy
metadata:
  name: 12-block-slack-tokens
  namespace: agentgateway-system
  labels:
    demo: agentgateway
    category: credential-protection
  annotations:
    description: "Blocks Slack bot tokens in prompts"
spec:
  targetRefs:
  - group: gateway.networking.k8s.io
    kind: HTTPRoute
    name: multi-llm-route
  backend:
    ai:
      promptGuard:
        request:
        - regex:
            action: Reject
            matches:
            - "xoxb-[a-zA-Z0-9-]+"
          response:
            message: "ğŸ”‘ Blocked: Slack token detected in prompt"
